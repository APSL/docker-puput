sudo: required
language: ruby
services:
- docker
script:
- ls -lah
- docker build -f Dockerfile -t apsl/puput .
- docker-compose -f docker-compose.yml up -d
- docker-compose -f docker-compose.yml ps
- sleep 10
- docker exec -ti dockerpuput_web_1 python manage.py migrate
- docker exec -ti dockerpuput_web_1 python manage.py puput_initial_data
- wget http://localhost:8000/blog/
notifications:
  email:
  - gshark@gmail.com
env:
  global:
  - PUPUT_VERSION=0.4.1
  - secure: 4PUpacQSQIIlimxACaa/xGVYgwstq88NpyEx17YwEDr5iCaa4iz3lgRlLWXzWtHIKCuo87rj+37p+e+HmIi3cGyBN5ZJqyS5zM64i/wbM3zbvoBODnZKvSrlZTCHqUJ3lkPzUrV2Z5orjAFGnw/+EssMQcS2ve/cTnF9wNjQ4DKDq4YYkjjkr4DQmZ+rUPQO0JAarxTW4G3a7ESkG1BxGHB67zYgh/gmYPLX3PPfj9PHSsS+DI5E61/MsQCiYvd1bzFVCf0y2sIUw8JUeCa04Jm72R1lipkQpxM2JTOcIAEbo/J4GRA12vENuKmfb4l4+kUt5upPcZyzYV/lWkamjh+WkKOYhoLfPyXfJYcgXVvMAdcpn3qcqKM/6bLgYOp9QaNy/lbVfUjLtxm48d9Nf/E1qKtSrR9l4kJtENsCPF8yLjFntbJdcOrjLWafgNFP7Xr25I7aVw1UH/YyQ/nUncdtYojIR9Cgz+d8SoA/XbZkZuJU3jcAyGuoaPlrPaC8V/jb09gSaXDwzzzKqvje2B3OEADvGvV3FhNkbiljV1IM4A9GvCzhcs/c68uynugaJDWtxJWzuc+cYU2rAmt0B/qEWEBTXm/3YWQAe3zQJz4gM1c+kUh0yRxezWiZl/um0EW2onQJxBrGNRVUZSW+AipL3TzOR4iS9ZbRW68aJl4=
  - secure: BY+dmh9nDVVfeHFnil+OFDjoom2rZR3vy1SsJyOvuiukNRyfBY0WCnBK6FcTGtZfKtkqC/oisPPvHGYvjQcN2YLwwy/4ipuSgmBHUbrl1MtOM7wkE+OHj+/0UmOd7empDZwxO0xNl2qxLD79DBovqwnC7NAE30KigZzuPjsanelRMvV0yjoiIzvxaNMjDZy5xwjwOKPbyaeTaRBAJrV4/8Xxl1lx170A4VqmkEg14TT3lanluXeZ8MzjUkN31V2fpbEAKFQXteJtUawkWRmeScXkc3UrCNZYbH0RySObzc82gy7gUtCHJ7Kotfkqlh9I5Inod2krZa2J8vsG94HyP0e3aPjEktVHvmGMcrSueP+OnjqNt5af+Zx52HkHijjmsJ+Qzqo2i2dwW1mcOtMRyy7X4AUcaMVqcRNlGl92D5XadMLy6MPly/ftjEWTq/KpZi0JGHl3mWK3pzK59FzNpiYD+jf0CoHtf5jij8+JAnnWdrSj/FBNIbTL6gZZ2rxNj6lVZLzLSSpJ1CfnEmNcCVjkpvTVN9Fqf/QinuMKZ7W2QYIclhDyBG5JLlt2YSncUJFqcW+8mXwfOf549azLLuWNHN3zRyKfApG8qK3FQOfJQyHLQx80N2Q6B0MFryN77jhzYXqvt1a0nKfCbTgUD+vV+ACMbD3iYs5AYsaFNhI=
  - secure: Aix2ShiX8R5F4M8iWgJWa3eTh5MCMDdYfnQyo6FQ51G8W6iQDqEoPEomrD/L8BvxOOKBJ7aNZxdwcZyIEB1EyobF+zG/DIFZ3D+oE5xnRNrT8STRIG0/M7nEcwAyy2UYs0w4fW/ApjCa4LEHXBX+7pXueE71yp5IeDZJR9X5mynyYBLDCFcM1jnNLSTqnIIIqnCQ6xfl2+1cbf9hii91aY2PbFk0vXTl9NTDnjfiIbA+NPYanr6rnpNeV9Qd51iCs60TJpzgnmM8gVI+SHXYQhyIsr0CLoZ/W1sVLK0XENWnVpZt7Aajm/vG+2+CL8AcBUbipG+F7alLZVyo2plIZkmotmDmHwn1npLqCrXfKkQ23KfP1FCZCdCOaY1d7quDkMxX2/i+Mg0wRJoEESiEvqboRd+U0LXBq6y6Fm4oAVucpiW0VZE6Yrcix4DB3xEHhcULuggxAvO8RKgHg5/QywLtoNh8uszRu3t0VPgbq+k4mU65Xj8ovSCnWcXOLgUTvgDHf89lA08RHITpNRhd8ylHDrobw9bV5vzWwaeOFcK4LcyYE2qvrISvLpNn2Y4Ned7YUa74nFI5hla1HyVjjsTFe3aZeaJElno+uc1ZTGxTslN93NPyYZbKH7eEwvKEhLnddNvbroAbPN88CBRyeR7ZS3xwbmEcoFS4fcqcBc4=
after_success:
- docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
- export TAG=`if [ "$TRAVIS_BRANCH" == "master" ]; then echo "latest"; else echo $PUPUT_VERSION; fi`
- docker tag apsl/puput apsl/puput:$TAG
- docker push apsl/puput:$TAG


 
